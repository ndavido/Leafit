{"version":3,"names":["React","Marker","GMMarker","OverlayViewF","GMOverlayView","useGoogleMap","mapMouseEventToMapEvent","Callout","CalloutContext","Component","constructor","props","state","calloutVisible","showCallout","setState","hideCallout","render","createElement","MarkerF","_extends","toggleCalloutVisible","_props$anchor","_props$anchor2","map","customMarkerContainerRef","useRef","markerSize","setMarkerSize","useState","width","height","useEffect","current","clientWidth","clientHeight","onMarkerPress","e","_props$onPress","onPress","call","coordinate","hasNonCalloutChildren","useMemo","Children","toArray","children","find","child","type","anchor","x","y","calloutAnchor","calloutContextValue","Provider","value","Fragment","mapPaneName","position","lat","Number","latitude","lng","longitude","getPixelPositionOffset","w","h","ref","onClick","draggable","title","onDrag","_props$onDrag","onDragStart","_props$onDragStart","onDragEnd","_props$onDragEnd","options","clickable","tappable","opacity","anchorPoint","google","maps","Point"],"sources":["marker.web.tsx"],"sourcesContent":["import React from 'react';\nimport type { ReactElement, Ref } from 'react';\nimport {\n  Marker as GMMarker,\n  OverlayViewF as GMOverlayView,\n  useGoogleMap,\n} from '@react-google-maps/api';\nimport type { MapMarkerProps, Point } from 'react-native-maps';\nimport { mapMouseEventToMapEvent } from '../utils/mouse-event';\nimport { Callout, CalloutContext } from './callout';\nimport type { CalloutContextType } from './callout';\n\ninterface MarkerState {\n  calloutVisible: boolean;\n}\n\n//Wrapped in class component to provide methods\n//forwardRef + useImperativeHandle not sufficient because it returns a ForwardRefExoticComponent which does not seem to render in the MapView\nexport class Marker extends React.Component<MapMarkerProps, MarkerState> {\n  constructor(props: MapMarkerProps) {\n    super(props);\n    this.state = { calloutVisible: false };\n  }\n\n  showCallout() {\n    this.setState({ calloutVisible: true });\n  }\n\n  hideCallout() {\n    this.setState({ calloutVisible: false });\n  }\n\n  render(): React.ReactNode {\n    return (\n      <MarkerF\n        {...this.props}\n        calloutVisible={this.state.calloutVisible}\n        toggleCalloutVisible={() =>\n          this.setState({ calloutVisible: !this.state.calloutVisible })\n        }\n      />\n    );\n  }\n}\n\ninterface MarkerFProps extends MapMarkerProps {\n  calloutVisible: boolean;\n  toggleCalloutVisible: () => void;\n}\n\nfunction MarkerF(props: MarkerFProps) {\n  const map = useGoogleMap();\n\n  const customMarkerContainerRef = React.useRef<HTMLDivElement>();\n  const [markerSize, setMarkerSize] = React.useState<{\n    width: number;\n    height: number;\n  }>({ width: 22, height: 40 }); //22 x 40 is the default google maps marker size\n\n  React.useEffect(() => {\n    if (customMarkerContainerRef.current) {\n      setMarkerSize({\n        width: customMarkerContainerRef.current.clientWidth,\n        height: customMarkerContainerRef.current.clientHeight,\n      });\n    }\n  }, [customMarkerContainerRef.current]);\n\n  const onMarkerPress = (e?: google.maps.MapMouseEvent) => {\n    props.onPress?.(\n      mapMouseEventToMapEvent(e, props.coordinate, map, 'marker-press')\n    );\n    props.toggleCalloutVisible();\n  };\n\n  const hasNonCalloutChildren = React.useMemo(\n    () =>\n      !!React.Children.toArray(props.children).find((child) => {\n        return (child as ReactElement).type !== Callout;\n      }),\n    [props.children]\n  );\n\n  //Default anchor values to react-native-maps values (https://github.com/react-native-maps/react-native-maps/blob/master/docs/marker.md)\n  const anchor: Point = props.anchor || { x: 0.5, y: 1 };\n  const calloutAnchor: Point = props.calloutAnchor || { x: 0.5, y: 0 };\n\n  const calloutContextValue: CalloutContextType = {\n    calloutVisible: props.calloutVisible,\n    toggleCalloutVisible: props.toggleCalloutVisible,\n    coordinate: props.coordinate,\n    markerSize,\n    anchor: calloutAnchor,\n  };\n\n  return (\n    <CalloutContext.Provider value={calloutContextValue}>\n      <>\n        {hasNonCalloutChildren ? (\n          <GMOverlayView\n            mapPaneName=\"overlayMouseTarget\"\n            position={{\n              lat: Number(props.coordinate.latitude),\n              lng: Number(props.coordinate.longitude),\n            }}\n            getPixelPositionOffset={(w, h) => ({\n              x: -(w * anchor!.x),\n              y: -(h * anchor!.y),\n            })}\n          >\n            <div\n              ref={customMarkerContainerRef as Ref<HTMLDivElement>}\n              onClick={() => onMarkerPress()}\n            >\n              {props.children}\n            </div>\n          </GMOverlayView>\n        ) : (\n          <GMMarker\n            draggable={props.draggable}\n            title={props.title}\n            onClick={(e) => onMarkerPress(e)}\n            onDrag={(e) =>\n              props.onDrag?.(\n                mapMouseEventToMapEvent(e, props.coordinate, map, '')\n              )\n            }\n            onDragStart={(e) =>\n              props.onDragStart?.(\n                mapMouseEventToMapEvent(e, props.coordinate, map, '')\n              )\n            }\n            onDragEnd={(e) =>\n              props.onDragEnd?.(\n                mapMouseEventToMapEvent(e, props.coordinate, map, '')\n              )\n            }\n            options={{\n              clickable: props.tappable,\n              opacity: props.opacity,\n              draggable: props.draggable,\n              anchorPoint: props.anchor\n                ? new google.maps.Point(props.anchor?.x, props.anchor?.y)\n                : null,\n            }}\n            position={{\n              lat: Number(props.coordinate.latitude),\n              lng: Number(props.coordinate.longitude),\n            }}\n            children={props.children}\n          />\n        )}\n      </>\n    </CalloutContext.Provider>\n  );\n}\n"],"mappings":"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"}