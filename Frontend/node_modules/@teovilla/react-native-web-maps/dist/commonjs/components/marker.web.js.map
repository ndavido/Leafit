{"version":3,"names":["_react","_interopRequireDefault","require","_api","_mouseEvent","_callout","obj","__esModule","default","_extends","Object","assign","bind","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","Marker","React","Component","constructor","props","state","calloutVisible","showCallout","setState","hideCallout","render","createElement","MarkerF","toggleCalloutVisible","exports","_props$anchor","_props$anchor2","map","useGoogleMap","customMarkerContainerRef","useRef","markerSize","setMarkerSize","useState","width","height","useEffect","current","clientWidth","clientHeight","onMarkerPress","e","_props$onPress","onPress","mapMouseEventToMapEvent","coordinate","hasNonCalloutChildren","useMemo","Children","toArray","children","find","child","type","Callout","anchor","x","y","calloutAnchor","calloutContextValue","CalloutContext","Provider","value","Fragment","OverlayViewF","mapPaneName","position","lat","Number","latitude","lng","longitude","getPixelPositionOffset","w","h","ref","onClick","draggable","title","onDrag","_props$onDrag","onDragStart","_props$onDragStart","onDragEnd","_props$onDragEnd","options","clickable","tappable","opacity","anchorPoint","google","maps","Point"],"sources":["marker.web.tsx"],"sourcesContent":["import React from 'react';\nimport type { ReactElement, Ref } from 'react';\nimport {\n  Marker as GMMarker,\n  OverlayViewF as GMOverlayView,\n  useGoogleMap,\n} from '@react-google-maps/api';\nimport type { MapMarkerProps, Point } from 'react-native-maps';\nimport { mapMouseEventToMapEvent } from '../utils/mouse-event';\nimport { Callout, CalloutContext } from './callout';\nimport type { CalloutContextType } from './callout';\n\ninterface MarkerState {\n  calloutVisible: boolean;\n}\n\n//Wrapped in class component to provide methods\n//forwardRef + useImperativeHandle not sufficient because it returns a ForwardRefExoticComponent which does not seem to render in the MapView\nexport class Marker extends React.Component<MapMarkerProps, MarkerState> {\n  constructor(props: MapMarkerProps) {\n    super(props);\n    this.state = { calloutVisible: false };\n  }\n\n  showCallout() {\n    this.setState({ calloutVisible: true });\n  }\n\n  hideCallout() {\n    this.setState({ calloutVisible: false });\n  }\n\n  render(): React.ReactNode {\n    return (\n      <MarkerF\n        {...this.props}\n        calloutVisible={this.state.calloutVisible}\n        toggleCalloutVisible={() =>\n          this.setState({ calloutVisible: !this.state.calloutVisible })\n        }\n      />\n    );\n  }\n}\n\ninterface MarkerFProps extends MapMarkerProps {\n  calloutVisible: boolean;\n  toggleCalloutVisible: () => void;\n}\n\nfunction MarkerF(props: MarkerFProps) {\n  const map = useGoogleMap();\n\n  const customMarkerContainerRef = React.useRef<HTMLDivElement>();\n  const [markerSize, setMarkerSize] = React.useState<{\n    width: number;\n    height: number;\n  }>({ width: 22, height: 40 }); //22 x 40 is the default google maps marker size\n\n  React.useEffect(() => {\n    if (customMarkerContainerRef.current) {\n      setMarkerSize({\n        width: customMarkerContainerRef.current.clientWidth,\n        height: customMarkerContainerRef.current.clientHeight,\n      });\n    }\n  }, [customMarkerContainerRef.current]);\n\n  const onMarkerPress = (e?: google.maps.MapMouseEvent) => {\n    props.onPress?.(\n      mapMouseEventToMapEvent(e, props.coordinate, map, 'marker-press')\n    );\n    props.toggleCalloutVisible();\n  };\n\n  const hasNonCalloutChildren = React.useMemo(\n    () =>\n      !!React.Children.toArray(props.children).find((child) => {\n        return (child as ReactElement).type !== Callout;\n      }),\n    [props.children]\n  );\n\n  //Default anchor values to react-native-maps values (https://github.com/react-native-maps/react-native-maps/blob/master/docs/marker.md)\n  const anchor: Point = props.anchor || { x: 0.5, y: 1 };\n  const calloutAnchor: Point = props.calloutAnchor || { x: 0.5, y: 0 };\n\n  const calloutContextValue: CalloutContextType = {\n    calloutVisible: props.calloutVisible,\n    toggleCalloutVisible: props.toggleCalloutVisible,\n    coordinate: props.coordinate,\n    markerSize,\n    anchor: calloutAnchor,\n  };\n\n  return (\n    <CalloutContext.Provider value={calloutContextValue}>\n      <>\n        {hasNonCalloutChildren ? (\n          <GMOverlayView\n            mapPaneName=\"overlayMouseTarget\"\n            position={{\n              lat: Number(props.coordinate.latitude),\n              lng: Number(props.coordinate.longitude),\n            }}\n            getPixelPositionOffset={(w, h) => ({\n              x: -(w * anchor!.x),\n              y: -(h * anchor!.y),\n            })}\n          >\n            <div\n              ref={customMarkerContainerRef as Ref<HTMLDivElement>}\n              onClick={() => onMarkerPress()}\n            >\n              {props.children}\n            </div>\n          </GMOverlayView>\n        ) : (\n          <GMMarker\n            draggable={props.draggable}\n            title={props.title}\n            onClick={(e) => onMarkerPress(e)}\n            onDrag={(e) =>\n              props.onDrag?.(\n                mapMouseEventToMapEvent(e, props.coordinate, map, '')\n              )\n            }\n            onDragStart={(e) =>\n              props.onDragStart?.(\n                mapMouseEventToMapEvent(e, props.coordinate, map, '')\n              )\n            }\n            onDragEnd={(e) =>\n              props.onDragEnd?.(\n                mapMouseEventToMapEvent(e, props.coordinate, map, '')\n              )\n            }\n            options={{\n              clickable: props.tappable,\n              opacity: props.opacity,\n              draggable: props.draggable,\n              anchorPoint: props.anchor\n                ? new google.maps.Point(props.anchor?.x, props.anchor?.y)\n                : null,\n            }}\n            position={{\n              lat: Number(props.coordinate.latitude),\n              lng: Number(props.coordinate.longitude),\n            }}\n            children={props.children}\n          />\n        )}\n      </>\n    </CalloutContext.Provider>\n  );\n}\n"],"mappings":"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"}